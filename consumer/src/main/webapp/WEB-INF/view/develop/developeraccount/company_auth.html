@layout("/common/_container.html"){
<script src="${ctxPath}/static/js/common/web-upload-file.js"></script>
<link href="${ctxPath}/static/css/plugins/steps/jquery.steps.css" rel="stylesheet"/>
<div class="ibox float-e-margins">
	<div class="ibox-title">
		<h5>企业认证</h5>
	</div>
	<div class="ibox-content">
		<div id="form2" class="wizard-big">
			<h1>填写资料</h1>
			<fieldset>
				<div class="form-horizontal" id="">
					<div class="row">
						<div class="col-sm-12">
							<input type="hidden" id="isNew" name="isNew" value="${isNew!}">
							<input type="hidden" id="status" name="status" value="${item.status!}">
							<input  type="hidden" id="id" value="${item.id!}" name="id" type="text">
							<div class="form-group">
								<label class="col-sm-1 control-label" style="width: 10%;">应用名称 </label>
								<div class="col-sm-11" style="width: 90%;">
									<input id="appname" name="appname" type="text" placeholder="请输入应用名称" style="width: 300px;"
										   value="${item.appname!}"	class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-1 control-label" style="width: 10%;">企业名称 </label>
								<div class="col-sm-11" style="width: 90%;">
									<input id="companyname" name="companyname" type="text" placeholder="请输入企业名称" style="width: 300px;"
									 value="${item.companyname!}"	class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-1 control-label" style="width: 10%;">企业信用码 </label>
								<div class="col-sm-11" style="width: 90%;">
									<input id="companycode" name="companycode" type="text" placeholder="请输入企业统一社会信用码" style="width: 300px;"
									 value="${item.companycode!}"	class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-1 control-label" style="width: 10%;">企业地址 </label>
								<div class="col-sm-11" style="width: 90%;">
									<input id="companyaddress" name="companyaddress" type="text" placeholder="请输入企业地址" style="width: 300px;"
									 value="${item.companyaddress!}"	class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-1 control-label" style="width: 10%;">联系人 </label>
								<div class="col-sm-11" style="width: 90%;">
									<input id="contacts" name="contacts" type="text" placeholder="请输入联系人" style="width: 300px;"
									 value="${item.contacts!}"	class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-1 control-label" style="width: 10%;">安全手机 </label>
								<div class="col-sm-11" style="width: 90%;">
									<input id="phonenum" name="phonenum" type="text" placeholder="请输入手机号" style="width: 300px;"
									 value="${item.phonenum!}"	class="form-control">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-1 control-label" style="width: 10%;">手机验证码 </label>
								<div class="col-sm-11" style="width: 90%;">
									<input id="verificationcode" name="verificationcode" placeholder="请输入验证码" style="width: 150px;display: inline;"
										type="text" class="form-control">
										<button id="btn_verificationcode" class="btn btn-primary" style="display: inline;margin-left: 20px;" onclick="CompanyAuthDlg.getVerificationCode()">获取验证码</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</fieldset>
			<h1>上传合同与营业执照</h1>
			<fieldset>
			<div class="form-horizontal" id="">
				<div class="row">
					<div class="col-sm-12">

						<div class="form-group">
							<label class="col-sm-1 control-label">合同附件</label>
							<div class="col-sm-9" style="top: -10px;">
								<input class="form-control" readonly="readonly"
									id="contractfilefilename" value="${item.contractfile!}" type="text"
									style="width: 45%;display: inline-block;">
								<div class="upload-btn" id="contractfileBtnId"
									style="display: inline-block;top: 10px;">
									<i class="fa fa-upload"></i>&nbsp;选择文件
								</div>
							</div>
							<input type="hidden" id="contractfile" value="${item.contractfilepath!}" />
						</div>

						<div class="form-group">
							<label class="col-sm-1 control-label">营业执照</label>
							<div class="col-sm-4">
								<div id="licensefilePreId">
									<div>
										<img width="200px" height="250px"
										@if(isEmpty(item.licensefilepath)){
						                      src="${ctxPath}/static/img/resource.png">
						                @}else{
						                      src="${ctxPath}/kaptcha/${item.licensefilepath!}">
						                @}
									</div>
								</div>
							</div>
							<div class="col-sm-2">
								<div class="head-scu-btn upload-btn" id="licensefileBtnId">
									<i class="fa fa-upload"></i>&nbsp;上传
								</div>
							</div>
							<input type="hidden" id="licensefile" value="${item.licensefilepath!}" />
						</div>


						<!-- 上传附件进度条 -->
						<div class="progress progress-striped" id="progressTipArea"
							style="margin-top: 20px;">
							<div id="progressBar" style="width: 0%" aria-valuemax="100"
								aria-valuemin="0" aria-valuenow="0" role="progressbar"
								class="progress-bar progress-bar-info"></div>
						</div>
					</div>
				</div>
				</div>
			</fieldset>

			<h1>等待审核</h1>
			<fieldset>
				<div class="text-center" style="">
					<img width="200px" height="200px"
						src="${ctxPath}/static/img/audit.png"><br />
					<h3>资料已提交，感谢耐心等待</h3>
				</div>
			</fieldset>

			<h1>完成认证</h1>
			<fieldset>
				<div class="text-center" style="">
					<img width="200px" height="200px"
						src="${ctxPath}/static/img/success.png"><br />
					<h3>认证成功</h3>
				</div>
			</fieldset>
		</div><!-- form -->
	</div>
</div>
<!-- Steps -->
    <script src="${ctxPath}/static/js/plugins/staps/jquery.steps.min.js"></script>
    <script src="${ctxPath}/static/modular/develop/developeraccount/company_auth.js"></script>
	<script>
		
		function togglePrevious(enable) { toggleButton("previous", enable); }
		function toggleNext (enable) { toggleButton("next", enable); }
		function toggleFinish (enable) { toggleButton("finish", enable);
		}
		function toggleButton(buttonId, enable) {
			if (enable) {
				//Enable disabled button
				var button = $("#form2").find('a[href="#' + buttonId + '-disabled"]');
				button.attr("href", '#' + buttonId);
				button.parent().removeClass();
			} else {
				//Disable enabled button
				var button = $("#form2").find('a[href="#' + buttonId + '"]');
				button.attr("href", '#' + buttonId + '-disabled');
				button.parent().addClass("disabled");
			}
		}
		$(document).ready(function () {
			var isNew = $("#isNew").val();
            var status = $("#status").val();
            var stepsWizard = $("#form2").steps({
                bodyTag: "fieldset",
                enableFinishButton: false,
                enableCancelButton: false,
                onStepChanging: function (event, currentIndex, newIndex) {
                console.log("当前页"+currentIndex+"，准备调整页"+newIndex);
                    // Always allow going backward even if the current step contains invalid fields!
                    //始终允许后退，即使当前步骤包含无效字段!
                    if (currentIndex > newIndex) {
                        return true;
                    }

                    // Forbid suppressing "Warning" step if the user is to young
                    //禁止压制“警告”步骤，如果用户是年轻的
                    if (newIndex === 3 && Number($("#age").val()) < 18) {
                        return false;
                    }

                    var form = $(this);

                    // Clean up if user went backward before
                    //如果用户以前后退了，请清除
                    if (currentIndex < newIndex) {
                        // To remove error styles
                        $(".body:eq(" + newIndex + ") label.error", form).remove();
                        $(".body:eq(" + newIndex + ") .error", form).removeClass("error");
                    }

                    // Disable validation on fields that are disabled or hidden.

                    // Start validation; Prevent going forward if false
                    //开始验证;如果错误，则阻止向前
                    var flag = true;
                    if(currentIndex==0){
                    	//当前页为填写资料页面
                    	flag = CompanyAuthDlg.validateview1();
					    //去除button变大的样式
						$(".webuploader-pick").removeClass("webuploader-pick");
                    	// 初始化资源上传
					    var fileUp = new $WebUploadFile("contractfile");
					    fileUp.setUploadBarId("progressBar");
					    fileUp.init();
					    // 初始化营业执照上传
					    var avatarUp = new $WebUpload("licensefile");
					    avatarUp.setUploadBarId("progressBar");
					    avatarUp.init();
                    }
                    if(currentIndex==1){
                    	//上传合同营业执照页
                    	if(isNew==1){
                    		//第一次进来
	                    	flag = CompanyAuthDlg.addSubmit();
                    	}
                    	if(status==3){
		            		//审核不通过
		            		flag = CompanyAuthDlg.addSubmit();
		            	}
                    	if(flag){
	                    	togglePrevious(false);
							toggleNext (false);
                    	}
                    }
                    return flag;
                },
                onStepChanged: function (event, currentIndex, priorIndex) {
                    
                }
            });
            if(isNew==0){
            	//非第一次进来
            	var indx = 1;
            	if(status==3){
            		//审核不通过，不跳转
            		Feng.error("审核不通过，请重新提交资料!");
            	}else{
            		if(status==1){
            			//审核通过，直接跳到完成
            			indx = 2;
	            	}
					for (i = 0; i <= indx; i++) {
						stepsWizard.steps("next");
					}
            	}
            	
            }
        });
    </script>
@}
